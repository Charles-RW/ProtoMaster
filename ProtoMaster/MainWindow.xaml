<Window x:Class="ProtoMaster.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ProtoMaster"
        xmlns:dock="https://github.com/Dirkster99/AvalonDock"
        mc:Ignorable="d"
        Title="ProtoMaster" Height="700" Width="1200"
        Background="{DynamicResource WindowBackgroundBrush}">
    <Window.Resources>
        <!--<Style TargetType="MenuItem">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="Background" Value="{DynamicResource MenuBackgroundBrush}"/>
        </Style>-->
        <Style TargetType="Separator">
            <Setter Property="Background" Value="{DynamicResource SeparatorBrush}"/>
        </Style>
        
        <!-- TreeView右键菜单样式 -->
        <Style x:Key="TreeNodeContextMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="{DynamicResource MenuBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="TreeNodeMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
            <Setter Property="Background" Value="{DynamicResource MenuBackgroundBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="{DynamicResource HighlightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- TreeView节点右键菜单 -->
        <ContextMenu x:Key="TreeNodeContextMenu" Style="{StaticResource TreeNodeContextMenuStyle}">
            <MenuItem Header="同步到对应节点" Style="{StaticResource TreeNodeMenuItemStyle}"
                      Click="SyncToCorrespondingNode_Click">
                <MenuItem.Icon>
                    <Path Data="M12,18.5L21,9.53L19.59,8.12L12,15.67L4.41,8.09L3,9.5L12,18.5M12,12.5L21,3.53L19.59,2.12L12,9.67L4.41,2.09L3,3.5L12,12.5Z" 
                          Fill="{DynamicResource PrimaryTextBrush}" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
            <Separator/>
            <MenuItem Header="展开全部子节点" Style="{StaticResource TreeNodeMenuItemStyle}"
                      Click="ExpandAllNodes_Click">
                <MenuItem.Icon>
                    <Path Data="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" 
                          Fill="{DynamicResource PrimaryTextBrush}" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
            <MenuItem Header="折叠全部子节点" Style="{StaticResource TreeNodeMenuItemStyle}"
                      Click="CollapseAllNodes_Click">
                <MenuItem.Icon>
                    <Path Data="M19,13H5V11H19V13Z" 
                          Fill="{DynamicResource PrimaryTextBrush}" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
            <Separator/>
            <MenuItem Header="复制节点数据 (JSON)" Style="{StaticResource TreeNodeMenuItemStyle}"
                      Click="CopyNodeAsJson_Click">
                <MenuItem.Icon>
                    <Path Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" 
                          Fill="{DynamicResource PrimaryTextBrush}" Width="16" Height="16"/>
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>
        
        <!-- AvalonDock Theme Style -->
        <!--<Style TargetType="{x:Type dock:DockingManager}">
        </Style>-->
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{DynamicResource MenuBackgroundBrush}">
            <MenuItem Header="文件">
                <MenuItem Header="打开文件" Click="OpenFile_Click"/>
                <MenuItem Header="打开目录" Click="OpenDirectory_Click"/>
                <Separator/>
                <MenuItem Header="退出" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="视图">
                <MenuItem Header="Common 数据" IsCheckable="True" IsChecked="True" 
                          x:Name="MenuShowCommonData" Click="ToggleCommonDataPanel_Click"/>
                <MenuItem Header="Plugin 数据" IsCheckable="True" IsChecked="True" 
                          x:Name="MenuShowPluginData" Click="TogglePluginDataPanel_Click"/>
                <MenuItem Header="重置布局" Click="ResetLayout_Click"/>
            </MenuItem>
            <MenuItem Header="主题">
                <MenuItem Header="深色主题" x:Name="MenuDarkTheme" IsCheckable="True" IsChecked="True"
                          Click="DarkTheme_Click"/>
                <MenuItem Header="浅色主题" x:Name="MenuLightTheme" IsCheckable="True" IsChecked="False"
                          Click="LightTheme_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Tool Bar -->
        <ToolBar Grid.Row="1" Background="{DynamicResource ToolBarBackgroundBrush}">
            <Button Content="加载数据" Click="LoadData_Click" Style="{DynamicResource ThemedButton}"/>
            <Separator Background="{DynamicResource SeparatorBrush}"/>
            <TextBlock Text="状态:" VerticalAlignment="Center" Margin="5,0" 
                       Foreground="{DynamicResource PrimaryTextBrush}"/>
            <TextBlock x:Name="StatusText" Text="就绪" VerticalAlignment="Center"
                       Foreground="{DynamicResource SecondaryTextBrush}"/>
        </ToolBar>
        
        <!-- Main Docking Area -->
        <dock:DockingManager Grid.Row="2" x:Name="DockingManager"
                             Background="{DynamicResource SecondaryBackgroundBrush}"
                             DocumentPaneMenuItemHeaderTemplate="{x:Null}">
            <dock:LayoutRoot>
                <dock:LayoutPanel Orientation="Horizontal">
                    
                    <!-- Left Panel for Common Data -->
                    <dock:LayoutAnchorablePane DockWidth="350" DockMinWidth="200">
                        <dock:LayoutAnchorable ContentId="CommonData" 
                                               Title="Common 数据"
                                               x:Name="CommonDataAnchorable"
                                               CanHide="True"
                                               CanClose="False"
                                               CanFloat="True">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Column Header -->
                                <Grid Grid.Row="0" Background="{DynamicResource TreeViewBackgroundBrush}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" x:Name="CommonNameCol" MinWidth="50"/>
                                        <ColumnDefinition Width="5"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Name" Grid.Column="0" Margin="5,2" FontWeight="SemiBold" 
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                                                  Background="Transparent" ResizeBehavior="PreviousAndNext"/>
                                    <TextBlock Text="Value" Grid.Column="2" Margin="5,2" FontWeight="SemiBold" 
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    <Border Grid.ColumnSpan="3" VerticalAlignment="Bottom" 
                                            BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"/>
                                </Grid>
                                
                                <!-- TreeView -->
                                <TreeView Grid.Row="1" x:Name="CommonDataTreeView" 
                                          ItemsSource="{Binding CommonDataNodes}" 
                                          BorderThickness="0" VirtualizingPanel.IsVirtualizing="True" 
                                          VirtualizingPanel.VirtualizationMode="Recycling"
                                          Background="{DynamicResource TreeViewBackgroundBrush}"
                                          Tag="{Binding ElementName=CommonNameCol, Path=Width}">
                                    <TreeView.ItemTemplate>
                                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="{Binding RelativeSource={RelativeSource AncestorType=TreeView}, Path=Tag}"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding Name}" ToolTip="{Binding Name}"
                                                           Foreground="{DynamicResource PrimaryTextBrush}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Value}" Margin="10,0,0,0" 
                                                           ToolTip="{Binding Value}" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                            </Grid>
                                        </HierarchicalDataTemplate>
                                    </TreeView.ItemTemplate>
                                    <TreeView.ItemContainerStyle>
                                        <Style TargetType="TreeViewItem">
                                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
                                            <Setter Property="ContextMenu" Value="{StaticResource TreeNodeContextMenu}"/>
                                        </Style>
                                    </TreeView.ItemContainerStyle>
                                </TreeView>
                            </Grid>
                        </dock:LayoutAnchorable>
                    </dock:LayoutAnchorablePane>
                    
                    <!-- Center Document Area -->
                    <dock:LayoutDocumentPane>
                        <dock:LayoutDocument ContentId="MainView" 
                                             Title="主视图"
                                             CanClose="False">
                            <Grid Background="{DynamicResource SecondaryBackgroundBrush}">
                                <TextBlock Text="主视图区域" HorizontalAlignment="Center" 
                                           VerticalAlignment="Center" FontSize="16"
                                           Foreground="{DynamicResource SecondaryTextBrush}"/>
                            </Grid>
                        </dock:LayoutDocument>
                    </dock:LayoutDocumentPane>
                    
                    <!-- Right Panel for Plugin Data -->
                    <dock:LayoutAnchorablePane DockWidth="350" DockMinWidth="200">
                        <dock:LayoutAnchorable ContentId="PluginData" 
                                               x:Name="PluginDataAnchorable"
                                               Title="Plugin 数据"
                                               CanHide="True"
                                               CanClose="False"
                                               CanFloat="True">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Column Header -->
                                <Grid Grid.Row="0" Background="{DynamicResource TreeViewBackgroundBrush}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200" x:Name="PluginNameCol" MinWidth="50"/>
                                        <ColumnDefinition Width="5"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Name" Grid.Column="0" Margin="5,2" FontWeight="SemiBold" 
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                                                  Background="Transparent" ResizeBehavior="PreviousAndNext"/>
                                    <TextBlock Text="Value" Grid.Column="2" Margin="5,2" FontWeight="SemiBold" 
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    <Border Grid.ColumnSpan="3" VerticalAlignment="Bottom" 
                                            BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"/>
                                </Grid>
                                
                                <!-- TreeView -->
                                <TreeView Grid.Row="1" x:Name="PluginDataTreeView" 
                                          ItemsSource="{Binding PluginDataNodes}" 
                                          BorderThickness="0" VirtualizingPanel.IsVirtualizing="True"
                                          VirtualizingPanel.VirtualizationMode="Recycling"
                                          Background="{DynamicResource TreeViewBackgroundBrush}"
                                          Tag="{Binding ElementName=PluginNameCol, Path=Width}"
                                          SelectedItemChanged="PluginDataTreeView_SelectedItemChanged">
                                    <TreeView.ItemTemplate>
                                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="{Binding RelativeSource={RelativeSource AncestorType=TreeView}, Path=Tag}"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding Name}" ToolTip="{Binding Name}"
                                                           Foreground="{DynamicResource PrimaryTextBrush}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Value}" Margin="10,0,0,0" 
                                                           ToolTip="{Binding Value}" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                            </Grid>
                                        </HierarchicalDataTemplate>
                                    </TreeView.ItemTemplate>
                                    <TreeView.ItemContainerStyle>
                                        <Style TargetType="TreeViewItem">
                                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
                                            <Setter Property="ContextMenu" Value="{StaticResource TreeNodeContextMenu}"/>
                                        </Style>
                                    </TreeView.ItemContainerStyle>
                                </TreeView>
                            </Grid>
                        </dock:LayoutAnchorable>
                    </dock:LayoutAnchorablePane>
                    
                </dock:LayoutPanel>
            </dock:LayoutRoot>
        </dock:DockingManager>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="{DynamicResource StatusBarBackgroundBrush}">
            <StatusBarItem>
                <TextBlock x:Name="StatusBarText" Text="就绪" Foreground="{DynamicResource StatusBarTextBrush}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar x:Name="LoadProgress" Width="150" Height="16" 
                             Visibility="Collapsed" IsIndeterminate="True"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
